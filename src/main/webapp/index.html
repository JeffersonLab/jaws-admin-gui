<html>
<body>
<h1>JAWS Web Proxy</h1>
<h2>Registered Alarms</h2>
<div>
    <form id="registered-form" onsubmit="return false;">
        <ul>
            <li>Name: <input id="name" type="text" name="name" value=""/></li>
            <li>Rationale: <input id="rationale" type="text" name="rationale" value=""/></li>
        </ul>

        <input id="submit" type="button" value="Set"/>
    </form>
</div>
<script>
    let button = document.getElementById('submit');

    button.addEventListener("click", function(e) {
        let form = document.getElementById("registered-form");

        let promise = fetch("proxy/rest", {
            method: "PUT",
            body: new URLSearchParams(new FormData(form)),
            headers: {
                "Content-type": 'application/x-www-form-urlencoded;charset=UTF-8'
            }
        });

        form.reset();

    });
</script>
<ul id="registered-list"></ul>
<h2>Alarm Classes</h2>
<ul id="class-list"></ul>
<script>
    let evtSource = new EventSource('proxy/sse'),
    registeredList = document.getElementById('registered-list'),
    classList = document.getElementById('class-list');

    console.log('attempting sse...')

    evtSource.addEventListener("registration", function(e) {
        console.log('registration type message')
        var newElement = document.createElement("li");

        newElement.textContent = e.data;
        registeredList.appendChild(newElement);
    });

    evtSource.addEventListener("class", function(e) {
        console.log('class type message')
        var newElement = document.createElement("li");

        newElement.textContent = e.data;
        classList.appendChild(newElement);
    });

    evtSource.onerror = function(e) {
        console.log('error')
        console.log(e)
    }
</script>
</body>
</html>